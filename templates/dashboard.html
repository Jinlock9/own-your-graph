{% extends "base.html" %}
{% block title %}Dashboard — own/graph{% endblock %}
{% block content %}
<div class="page-header">
  <div>
    <div class="page-title"><span>//</span> Dashboard</div>
    <div style="font-size:0.72rem;color:var(--text-dim);margin-top:0.3rem;letter-spacing:0.06em;">
      {{ summaries|length }} metric{{ 's' if summaries|length != 1 else '' }} tracked
    </div>
  </div>
  <a href="/metrics/new" class="btn">+ New Metric</a>
</div>

{% if not summaries %}
<div class="card" style="text-align:center;padding:3rem;">
  <div style="font-size:2rem;margin-bottom:1rem;color:var(--text-dim);">[ ]</div>
  <div style="font-size:0.9rem;color:var(--text-dim);">No metrics yet.</div>
  <div style="margin-top:1.5rem;">
    <a href="/metrics/new" class="btn">Create your first metric →</a>
  </div>
</div>
{% else %}
<div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:1.2rem;">
  {% for s in summaries %}
  <a href="/metrics/{{ s.metric.id }}" style="text-decoration:none;">
    <div class="card" style="transition:border-color 0.2s,box-shadow 0.2s;cursor:pointer;"
         onmouseover="this.style.borderColor='rgba(0,229,255,0.35)';this.style.boxShadow='0 0 24px rgba(0,229,255,0.07)'"
         onmouseout="this.style.borderColor='';this.style.boxShadow=''">

      <!-- Header -->
      <div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:1rem;">
        <div>
          <div style="font-family:'Syne',sans-serif;font-weight:700;font-size:1rem;color:#fff;">
            {{ s.metric.name }}
          </div>
          {% if s.metric.description %}
          <div style="font-size:0.72rem;color:var(--text-dim);margin-top:0.2rem;">{{ s.metric.description }}</div>
          {% endif %}
        </div>
        <div style="display:flex;gap:0.4rem;flex-wrap:wrap;justify-content:flex-end;">
          {% if s.metric.unit %}<span class="tag tag-accent">{{ s.metric.unit }}</span>{% endif %}
          <span class="tag">{{ s.count }} pts</span>
          {% if s.metric.graph_mode == 'multi' %}
            <span class="tag" style="border-color:rgba(255,171,64,0.35);color:var(--warn);">multi</span>
          {% endif %}
          {% if s.metric.lower_better %}
            <span class="tag" style="color:var(--text-dim)">↓ better</span>
          {% else %}
            <span class="tag" style="color:var(--text-dim)">↑ better</span>
          {% endif %}
        </div>
      </div>

      <!-- Stats -->
      {% if s.metric.graph_mode == 'multi' %}

        {% if s.series_summary %}
        <!-- Per-series table: label | latest | vs. first % -->
        <div style="border-top:1px solid var(--border);padding-top:0.6rem;">
          <div style="display:flex;justify-content:space-between;
                      font-size:0.6rem;letter-spacing:0.1em;text-transform:uppercase;
                      color:var(--text-dim);padding-bottom:0.35rem;
                      border-bottom:1px solid rgba(255,255,255,0.04);">
            <span>Series</span>
            <div style="display:flex;gap:2rem;">
              <span>Latest</span>
              <span>vs. First</span>
            </div>
          </div>
          {% for ss in s.series_summary %}
          <div style="display:flex;justify-content:space-between;align-items:baseline;
                      padding:0.28rem 0;border-bottom:1px solid rgba(255,255,255,0.04);
                      {% if loop.last %}border-bottom:none;{% endif %}">
            <span style="font-size:0.72rem;color:var(--text-dim);letter-spacing:0.03em;">{{ ss.label }}</span>
            <div style="display:flex;gap:2rem;align-items:baseline;">
              <span style="font-size:0.95rem;font-family:'Syne',sans-serif;font-weight:700;color:#fff;min-width:4rem;text-align:right;">
                {{ "%.4g"|format(ss.latest) }}
              </span>
              <span style="font-size:0.88rem;font-weight:600;font-family:'Syne',sans-serif;min-width:3.5rem;text-align:right;
                           color:{% if ss.count < 2 %}var(--text-dim){% elif ss.improved %}var(--success){% else %}var(--accent2){% endif %};">
                {% if ss.count < 2 %}—{% else %}{{ '+' if ss.pct > 0 else '' }}{{ "%.1f"|format(ss.pct) }}%{% endif %}
              </span>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div style="font-size:0.8rem;color:var(--text-dim);padding-top:0.5rem;">No entries yet.</div>
        {% endif %}

      {% else %}

        <!-- Single mode: original 3-col layout -->
        <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:0.8rem;">
          <div>
            <div style="font-size:0.65rem;letter-spacing:0.08em;text-transform:uppercase;color:var(--text-dim);">Latest</div>
            <div style="font-size:1.3rem;font-family:'Syne',sans-serif;font-weight:700;color:#fff;margin-top:0.1rem;">
              {% if s.latest is not none %}{{ "%.4g"|format(s.latest) }}{% else %}—{% endif %}
            </div>
          </div>
          <div>
            <div style="font-size:0.65rem;letter-spacing:0.08em;text-transform:uppercase;color:var(--text-dim);">Best</div>
            <div style="font-size:1.3rem;font-family:'Syne',sans-serif;font-weight:700;color:var(--success);margin-top:0.1rem;">
              {% if s.best is not none %}{{ "%.4g"|format(s.best) }}{% else %}—{% endif %}
            </div>
          </div>
          <div>
            <div style="font-size:0.65rem;letter-spacing:0.08em;text-transform:uppercase;color:var(--text-dim);">vs. First</div>
            {% if s.count >= 2 and s.pct is not none %}
              {% set improved = (s.pct < 0) if s.metric.lower_better else (s.pct > 0) %}
              <div style="font-size:1.3rem;font-family:'Syne',sans-serif;font-weight:700;margin-top:0.1rem;color:{{ '#00e676' if improved else '#ff4081' }};">
                {{ '+' if s.pct > 0 else '' }}{{ "%.1f"|format(s.pct) }}%
              </div>
            {% else %}
              <div style="font-size:1.3rem;font-family:'Syne',sans-serif;font-weight:700;margin-top:0.1rem;color:var(--text-dim);">—</div>
            {% endif %}
          </div>
        </div>

      {% endif %}

    </div>
  </a>
  {% endfor %}
</div>
{% endif %}
{% endblock %}
